# 独立组件路由模块与宿主路由融合

## 状态

- Draft
- 日期：2026-02-08

## 决策背景

项目类型中包含 `component` 与 `project`，但路由系统当前主要围绕页面项目思维构建。需求上希望：

1. 独立组件项目也能有路由预览能力
2. 组件被宿主项目引用时，其路由可被挂载与融合
3. 避免绝对路径冲突

## 决策内容

引入 **Route Module Composition**：

1. 独立组件导出“相对路由模块”
2. 宿主项目通过 `mountPath` 挂载该模块
3. 编译时将宿主路径前缀与模块路径合成最终路由
4. 组件模块运行时能力（loader/guard 等）受宿主策略裁剪

## 关键约束

1. 组件路由不允许以 `/` 开头作为绝对路径（除模块根占位）
2. 组件路由允许 `index`、动态段、通配符
3. 组件模块不得声明全局导航守卫（避免与宿主冲突）

## 示例

### 组件模块导出

```json
{
    "moduleId": "account-center",
    "routes": [
        { "segment": "", "index": true, "pageDocId": "account-home" },
        { "segment": "profile", "pageDocId": "account-profile" }
    ]
}
```

### 宿主挂载

```json
{
    "mountPath": "/user",
    "moduleRef": "account-center"
}
```

### 合成结果

- `/user` -> `account-home`
- `/user/profile` -> `account-profile`

## 为什么不直接共享绝对路由

1. 组件复用场景要求可在多个宿主路径下挂载
2. 绝对路径共享会引入冲突与依赖顺序问题
3. 组件与宿主应保持松耦合
4. 宿主必须拥有最终运行时治理权（鉴权/监控/实验）

## 迁移策略

1. `component` 类型先支持“单模块路由预览模式”
2. `project` 类型新增“挂载组件路由模块”能力
3. 导出时产物包含模块清单与合成后路由

## 风险与缓解

1. **风险：模块循环引用**
    - 缓解：模块图构建阶段做 DAG 校验
2. **风险：参数命名冲突**
    - 缓解：挂载时做参数命名空间规范与检测
3. **风险：调试复杂度提升**
    - 缓解：路由调试面板展示“源模块 -> 合成路径”映射

## 验收标准（Draft）

- [ ] `component` 项目可独立预览模块路由
- [ ] `project` 可挂载至少 2 个组件路由模块
- [ ] 路由合成结果可视化可追踪
- [ ] 路径冲突在编辑阶段可被阻止
