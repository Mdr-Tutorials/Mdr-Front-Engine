# Public 资源页（Resource Manager / Public）决策

## 状态

- Draft
- 日期：2026-02-17

## 决策背景

当前资源管理页仅有占位内容，无法承载 Public 静态资源在项目内的完整管理链路。实际需求已经明确：

1. Public 页面必须是独立页面（由资源管理页导航进入），而不是与其他资源块混排。
2. 页面核心布局为“左侧文件树 + 右侧预览”，不引入中间文件列表面板。
3. Public 文件树需支持编辑操作（新建文件夹/新建文件/重命名/删除/移动），而导出页面文件树是只读浏览，两者能力边界必须清晰。
4. 需要提供导入能力（分类导入）与最佳实践提示（命名、目录、体积、格式）。
5. Public 页面维护的文件树必须作为导出页面 `public/` 文件夹的单一来源，避免双写与不一致。

## 目标

1. 建立 Public 静态资源的“可编辑工作台”。
2. 建立导出页面与 Public 页面之间的同源数据关系。
3. 在不阻断开发效率的前提下，提供可执行的最佳实践提示体系。

## 决策内容

### 1) 页面结构决策

Public 页面固定采用双栏结构：

- 左栏：可编辑文件树（目录 + 文件）。
- 右栏：预览区 + 文件元信息 + 最佳实践提示。

不引入中间文件列表面板，避免交互冗余。

### 2) 文件树能力分层决策

统一抽象 `FileTree` 外观组件，但按模式切换能力：

- `readonly`：仅用于导出页面（浏览生成结果）。
- `editable`：仅用于 Public 页面（资源编辑）。

`editable` 模式必须支持：

1. 新建文件夹。
2. 新建文件（先支持空白文本/JSON/SVG）。
3. 重命名。
4. 删除。
5. 移动（首期按钮驱动，后续可扩展拖拽）。

### 3) 导入能力决策（分类导入）

Public 页面提供“分类导入”入口，内置分类：

- Image（png/jpg/webp/svg）
- Font（woff/woff2/ttf/otf）
- Document（txt/md/json）
- Other（任意文件）

导入后统一生成资源节点元数据：

- `id`
- `name`
- `path`
- `kind`
- `mime`
- `size`
- `contentRef`（Blob URL / hash / 持久化引用）

### 4) 预览能力决策

右侧预览支持分类型展示：

1. SVG：图形预览 + 源码切换。
2. Font：`@font-face` 预览样张（字母/数字/中英混排）。
3. Image：缩放预览。
4. Text/JSON：只读文本预览。
5. 其他：元信息与下载入口。

### 5) 最佳实践提示决策

采用“规则提示，不阻断提交”的策略：

- 检查维度：
  - 目录结构建议（如 `public/images`, `public/fonts`, `public/icons`）。
  - 命名规范建议（小写短横线、禁空格）。
  - 体积阈值（图片、字体超阈值告警）。
  - SVG 安全检查（脚本/外链提示）。
- 呈现方式：
  - 节点级提示标记。
  - 右侧详情建议卡片。
  - 页面汇总提示计数。

### 6) 与导出页面同源决策

Public 文件树是导出页面 `public/` 文件夹的单一来源：

- Resource Manager / Public 写入 `projectResources.publicTree`。
- Export 页面读取同一个 `projectResources.publicTree` 生成导出文件树中的 `public/*`。
- 禁止导出页面维护独立 Public 副本。

## 数据模型（Draft）

```ts
type PublicResourceNode = {
  id: string;
  name: string;
  type: 'folder' | 'file';
  path: string;
  parentId: string | null;
  kind?: 'image' | 'font' | 'document' | 'other';
  mime?: string;
  size?: number;
  contentRef?: string;
  updatedAt: string;
};

type PublicResourceTree = {
  rootId: string;
  nodes: Record<string, PublicResourceNode>;
};
```

## 标准调用链路

`PublicPage(UI) -> ResourceCommands(create/move/import/delete) -> projectResources.publicTree -> ExportBundleMapper(public/*) -> Export File Tree`

链路约束：

1. Public 页面与导出页面必须共享同一份 `publicTree`。
2. 导出页面只读，不允许修改 `publicTree`。
3. 所有编辑操作必须走资源命令层（为后续撤销/重做预留）。

## 非目标

1. 本阶段不实现远程对象存储直传（S3/OSS）。
2. 本阶段不实现多人并发编辑冲突解算。
3. 本阶段不实现复杂二进制编辑器（如图片裁剪器、字体子集化工具）。
4. 本阶段不覆盖资源许可证自动审计流程。

## 分阶段落地

### Phase 1：页面骨架与可编辑树

1. 完成 Public 子页面导航与双栏布局。
2. 抽象 `FileTree(mode)`，导出页接 `readonly`，Public 页接 `editable`。
3. 支持文件夹/文件基础操作。

### Phase 2：分类导入与预览

1. 完成分类导入入口与类型识别。
2. 实现 SVG/Font/Image/Text 预览。
3. 建立 `contentRef` 持有策略。

### Phase 3：最佳实践提示与导出同源

1. 完成规则引擎与提示 UI。
2. 打通 `publicTree -> export public/*` 同源映射。
3. 覆盖核心测试与边界条件。

## 验收标准（Draft）

- [ ] 资源管理页可切换到独立 Public 子页面，布局为“左树右预览”。
- [ ] Public 文件树支持新建文件夹、新建文件、重命名、删除、移动。
- [ ] 导入支持分类入口，导入后节点元数据完整。
- [ ] SVG、字体、图片、文本在右侧可预览。
- [ ] 最佳实践提示可见且不阻断编辑。
- [ ] 导出页面 `public/` 文件树与 Public 页面数据同源，不出现双写分叉。
